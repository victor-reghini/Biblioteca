-- Criando sequences

CREATE SEQUENCE IF NOT EXISTS SEQ_USUARIO 		INCREMENT 1 START 1;
CREATE SEQUENCE IF NOT EXISTS SEQ_LIVRO         INCREMENT 1 START 1;
CREATE SEQUENCE IF NOT EXISTS SEQ_EMPRESTIMO 	INCREMENT 1 START 1;


-- Criando tabelas

CREATE TABLE IF NOT EXISTS USUARIO (
   ID				INT8 NOT NULL DEFAULT nextval('seq_usuario') PRIMARY KEY,
   NOME				VARCHAR(120) NOT NULL,
   EMAIL			VARCHAR(255) NOT NULL,
   DATA_CADASTRO	DATE NOT NULL,
   TELEFONE			INT8 NOT NULL
);

CREATE TABLE IF NOT EXISTS LIVRO (
   ID				    INT8 NOT NULL DEFAULT nextval('seq_livro') PRIMARY KEY,
   TITULO				VARCHAR(60) NOT NULL,
   AUTOR		        VARCHAR(255) NOT NULL,
   ISBN			        INT8 NOT NULL,
   DATA_PUBLICACAO		DATE NOT NULL,
   CATEGORIA			VARCHAR(60) NOT NULL
);

CREATE TABLE IF NOT EXISTS EMPRESTIMO (
   ID				        INT8 NOT NULL DEFAULT nextval('seq_emprestimo') PRIMARY KEY,
   USUARIO_ID				INT8 NOT NULL,
   LIVRO_ID		            INT8 NOT NULL,
   DATA_EMPRESTIMO			DATE NOT NULL,
   DATA_DEVOLUCAO			DATE,
   STATUS			        VARCHAR(20) NOT NULL
);


-- configurando chaves estrangeiras

ALTER TABLE EMPRESTIMO ADD CONSTRAINT FK_EMPRESTIMO_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIO (ID);
ALTER TABLE EMPRESTIMO ADD CONSTRAINT FK_EMPRESTIMO_LIVRO FOREIGN KEY (LIVRO_ID) REFERENCES LIVRO (ID);
